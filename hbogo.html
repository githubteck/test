<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASH Player Links</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 16px;
            width: 90%;
        }

        .poster {
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }

        .poster img {
            width: 100%;
            display: block;
        }

        .title {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1>Available Shows</h1>
    <div class="grid" id="posterGrid"></div>

    <script>
        // Function to convert base64 license key to hex
        function base64ToHex(base64) {
            const binaryString = window.atob(base64);
            let hex = '';
            for (let i = 0; i < binaryString.length; i++) {
                const byte = binaryString.charCodeAt(i).toString(16);
                hex += ('00' + byte).slice(-2);
            }
            return hex;
        }

        // Fetch the M3U data
        async function fetchM3UData(url) {
            const response = await fetch(url);
            const text = await response.text();
            return parseM3U(text);
        }

        // Parse the M3U data
        function parseM3U(data) {
            const lines = data.split('\n');
            const items = [];
            let currentItem = null;

            for (const line of lines) {
                if (line.startsWith('#EXTINF:')) {
                    currentItem = { title: line.split(',')[1].trim() };
                } else if (line.startsWith('https://') && currentItem) {
                    currentItem.mpdLink = line.trim();
                    items.push(currentItem);
                    currentItem = null;
                } else if (line.startsWith('#KODIPROP:inputstream.adaptive.license_key')) {
                    const licenseKeyInfo = line.split('=')[1].trim();
                    const licenseKeyJson = JSON.parse(licenseKeyInfo);
                    const base64Key = licenseKeyJson.keys[0].k;
                    const hexKey = base64ToHex(base64Key);
                    currentItem.licenseKeyHex = hexKey;
                } else if (line.startsWith('#EXTLOGO')) {
                    currentItem.tvgLogo = line.split('=')[1].trim();
                }
            }
            return items;
        }

        // Display posters
        function displayPosters(items) {
            const grid = document.getElementById('posterGrid');
            items.forEach(item => {
                const div = document.createElement('div');
                div.classList.add('poster');
                div.innerHTML = `
                    <img src="${item.tvgLogo}" alt="${item.title}" />
                    <div class="title">${item.title}</div>
                `;
                div.onclick = () => {
                    window.open(`https://githubteck.github.io/test/dashplayer.html?url=${encodeURIComponent(item.mpdLink)}&key=${item.licenseKeyHex}`, '_blank');
                };
                grid.appendChild(div);
            });
        }

        // Execute fetching M3U data on load
        (async () => {
            const m3uUrl = 'https://raw.githubusercontent.com/mystery75/streaming/refs/heads/app/hbogoasia'; // M3U URL
            const items = await fetchM3UData(m3uUrl);
            displayPosters(items);
        })();
    </script>
</body>
</html>
